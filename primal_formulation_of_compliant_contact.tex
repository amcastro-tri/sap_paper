% Dummy comment for Reviewable.

\subsection{Primal Formulation}
\label{sec:primal_formulation}

We introduce a new decision variable $\vf{\sigma}\in\mathbb{R}^{3n_c}$ and set
up our convex formulation of compliant contact as the following 
optimization problem
\begin{equation}
	\begin{aligned}
	\min_{\mf{v},\bsigma} \quad & \ell_p(\mf{v},\bsigma) =
	\frac{1}{2}\Vert\mf{v}-\mf{v}^*\Vert_{A}^2 +
	\frac{1}{2} \Vert\bsigma\Vert_{R}^2\\
	\textrm{s.t.} \quad & \mf{g} = (\mf{J}\mf{v}-\hat{\mf{v}}_c + \mf{R}\bsigma) \in \mathcal{F}^*,\\
	\end{aligned}
	\label{eq:primal_regularized}
\end{equation}
where $\Vert\mf{z}\Vert_X^2=\mf{z}^T\mf{X}\mf{z}$ with $\mf{X}\succ 0$ and
$\mathcal{F^*}= \mathcal{F}^*_1 \times \mathcal{F}^*_2 \times \cdots \times
\mathcal{F}^*_{n_c}$ is the \emph{dual cone} of the friction cone $\mathcal{F} =
\mathcal{F}_1 \times \mathcal{F}_2 \times \cdots \times \mathcal{F}_{n_c}$, with
$\times$ the Cartesian product. The positive diagonal matrix
$\mf{R}\in\mathbb{R}^{3n_c\times 3n_c}$ and the vector of stabilization
velocities $\hat{\mf{v}}_c$ encode the problem data needed to model compliant
contact. We establish a very clear physical meaning for these terms in
Section~\ref{sec:physical_intuition}.  We note that when $R$ and $\bsigma$
are removed, this reformulation reduces to~\cite{bib:mazhar2014}.

We refer to~\eqref{eq:primal_regularized} as the \emph{primal formulation}
and next derive its dual. To begin, define the Lagrangian
\begin{equation}
    \mathcal{L}(\mf{v},\bsigma,\vf{\gamma}) = 
\frac{1}{2}\Vert\mf{v}-\mf{v}^*\Vert_A^2 + \frac{1}{2} \Vert\bsigma\Vert_{R}^2 - \vf{\gamma}^T\mf{g},
\end{equation}
where $\vf{\gamma}\in\mathcal{F}$ is the dual variable for the constraint
$\vf{g}\in \mathcal{F}^*$. Taking gradients of the Lagrangian with respect to $\mf{v}$ and $\bsigma$ leads
to the optimality conditions
\begin{subequations}\label{eq:primal_optimality_conditions}
\begin{align}
    \mf{A}(\mf{v}-\mf{v}^*) &= \mf{J}^T\vf{\gamma} \label{eq:momentum_optimality}\\
    \vf{\sigma} &= \vf{\gamma}.  \label{eq:sigma_equal_gamma}
\end{align}
\end{subequations}
Note that~\eqref{eq:momentum_optimality} is a restatement
of the balance of momentum \eqref{eq:momentum_linearized}
if the dual variable $\bgamma$ is interpreted as a vector of contact impulses. 
 Using the optimality
condition~\eqref{eq:sigma_equal_gamma} to eliminate $\vf{\sigma}$ from the
Lagrangian yields the dual formulation
\begin{align}
    \min_{\bgamma\in \mathcal{F}} \ell_d(\bgamma) =
    \frac{1}{2}\bgamma^T(\mathbf{W}+\mathbf{R})\bgamma + {\bm r}^T
    \bgamma,
	\label{eq:dual_regularized}
\end{align}
where $\mf{W}=\mf{J}\mf{A}^{-1}\mf{J}^T$ is the Delassus operator and
$\mf{r}=\mf{v}_c^*-\hat{\mf{v}}_c$ with $\mf{v}_c^*=\mf{J}\mf{v}^*$.
In summary, we have proven the following theorem.
\begin{theorem}\label{th:primal_dual} The dual of~\eqref{eq:primal_regularized}
	is given by~\eqref{eq:dual_regularized}. Moreover, when $\{\mf{v},\bsigma\}$ is
	primal optimal and $\bgamma$ is dual optimal, $\bsigma = \bgamma$.
\end{theorem}

Finally, we note that the dual~\eqref{eq:dual_regularized} is equivalent to the
formulation in~\cite{bib:todorov2011} when $\theta = 0$ in
Eq.~\eqref{eq:scheme_momentum} and $\mf{A}=\mf{M}(\mf{q}_0)$. 
