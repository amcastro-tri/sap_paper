% Dummy comment for Reviewable.

\algblockdefx{RepeatUntil}{EndRepeatUntil}{\textbf{repeat until}}{}
\algnotext{EndRepeatUntil}

\subsection{An Unconstrained Convex Formulation}
\label{sec:unconstrained_convex_formulation}

\reviewquestion{R1-Q7}{We use the analytical $\bgamma =
P_{\mathcal{F}}(\mf{y}(\mf{v}))$ from Section
\ref{sec:analytical_inverse_dynamics}} and the optimality condition $\vf{\sigma}
= \bgamma$ from Theorem~\ref{th:primal_dual} to eliminate both $\vf{\sigma}$ and
the constraints from the primal formulation \eqref{eq:primal_regularized}. In
total, we obtain the following unconstrained problem in velocities only
\begin{eqnarray}
	\min_{\mf{v}} \ell_p(\mf{v}) = \frac{1}{2}\Vert\mf{v}-\mf{v}^*\Vert_{A}^2 +
	\frac{1}{2}\Vert P_\mathcal{F}(\mf{y}(\mf{v}))\Vert_R^2.
	\label{eq:primal_unconstrained}
\end{eqnarray}
Correctness of this reformulation is asserted by the following theorem, which we
prove in Appendix \ref{app:unconstrained_formulation_equivalance}.
\begin{theorem}
  If  $\mf{v}$ solves the unconstrained formulation
    (\ref{eq:primal_unconstrained}), then $(\mf{v}, \bsigma)$, with $\bsigma
    =P_\mathcal{F}(\mf{y}(\mf{v}))$, solves the primal formulation
    (\ref{eq:primal_regularized}).
    \label{th:unconstrained_formulation_equivalance}
\end{theorem}
Lemma \ref{lem:PropertiesOfObj} in Appendix \ref{app:sap_converge} shows that
the unconstrained cost $\ell_p(\mf{v})$ is strongly convex and differentiable
with Lipschitz continuous gradients. Therefore, the unconstrained formulation
(\ref{eq:primal_unconstrained}) has a unique solution, and can be efficiently
solved.  
Section \ref{sec:sap_solver} presents our novel SAP solver specifically designed
for its solution.

We outline our overall time-stepping scheme in the following Algorithm
\begin{algorithm}[H]
	\caption{Overall Time-Stepping Strategy}
	  \label{alg:sap_time_stepping}
	  \begin{algorithmic}[1]
		  \State Solve free motion velocities from
		  $\mf{m}(\mf{v}^*)=\mf{0}$, Eq. \eqref{eq:m_definition}
		  \State Solve $\displaystyle \mf{v} = \argmin_{\mf{v}} \ell_p(\mf{v})$, Eq. \eqref{eq:primal_unconstrained}
		  \State Update positions $\displaystyle \mf{q} = \mf{q}_0 + \delta
		  t\mf{N}(\mf{q}^{\theta})\mf{v}^{\theta_{vq}}$, Eq. \eqref{eq:scheme_q_update}
	  \end{algorithmic}
\end{algorithm}

\reviewquestion{R1-Q1/R1-Q2}{We note that Algorithm
\ref{alg:sap_time_stepping} is executed once per time step, with no inner
iterations updating $\mf{A}$. That is, our strategy is not solving the original,
possibly nonlinear, balance of momentum \eqref{eq:scheme_momentum} but its
linear approximation in \eqref{eq:momentum_linearized}. It is important to note
however that the approximation can be exact for many of the multibody systems
encountered in practice. Joint springs and dampers for instance contribute
constant stiffness and damping matrices in \eqref{eq:expression_for_A} and
therefore the approximation is exact. On the other side of the spectrum,
Coriolis and gyroscopic terms are quadratic in the generalized velocities.
However, they can still be included using their Fr\'echet derivative
\cite{bib:potra2006linearly} in the Newton iteration used to compute $\mf{v}^*$
while our SPD linear approximation of Eq.~\eqref{eq:momentum_linearized} is
second order accurate as stated in Proposition
\ref{prop:gradient_of_m_approximation}, and proved in Appendix
\ref{app:gradient_of_m_approximation}.}
